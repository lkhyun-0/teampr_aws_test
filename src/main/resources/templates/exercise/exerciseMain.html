<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ìš´ë™ í˜ì´ì§€</title>
    <link href="/css/exercise/exerciseMain.css" rel="stylesheet">
    <!-- ì œì´ì¿¼ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸° -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
      $(document).ready(function () {
      // ë²„íŠ¼ í´ë¦­ í•˜ë©´ íŒì—… ë³´ì—¬ì¤Œ
      $('.target-write-btn').click(function () {
        console.log("target-write-btn ë“¤ì–´ì˜´");
        $('.target-popup').css('display', 'flex');
      });

      // ë²„íŠ¼ í´ë¦­ í•˜ë©´ íŒì—… ê°€ë¦¼
      $('.target-popup-close-btn').click(function () {
        $('.target-popup').css('display', 'none');
      });

      // .popupì„ í´ë¦­í•˜ë©´ ë‹«íˆë„ë¡ ì„¤ì •
      $(".target-popup").on("click", function () {
        $(this).hide(); // .popupì„ ìˆ¨ê¹€
      });

      // .popup-content ë‚´ë¶€ë¥¼ í´ë¦­í–ˆì„ ë•Œ ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€
      $(".target-popup-content").on("click", function (event) {
        event.stopPropagation(); // ë¶€ëª¨(.popup)ë¡œ ì´ë²¤íŠ¸ê°€ ì „ë‹¬ë˜ì§€ ì•Šë„ë¡ ë°©ì§€
      });

      // ë²„íŠ¼ í´ë¦­ í•˜ë©´ íŒì—… ë³´ì—¬ì¤Œ
      $('.exercise-type-popup-btn').click(function () {
        $('.exercise-type-popup').css('display', 'flex');
      });

      // ë²„íŠ¼ í´ë¦­ í•˜ë©´ íŒì—… ê°€ë¦¼
      $('.exercise-type-popup-close-btn').click(function () {
        $('.exercise-type-popup').css('display', 'none');
      });

      // .popupì„ í´ë¦­í•˜ë©´ ë‹«íˆë„ë¡ ì„¤ì •
      $(".exercise-type-popup").on("click", function () {
        $(this).hide(); // .popupì„ ìˆ¨ê¹€
      });

      // .popup-content ë‚´ë¶€ë¥¼ í´ë¦­í–ˆì„ ë•Œ ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€
      $(".exercise-type-popup-content").on("click", function (event) {
        event.stopPropagation(); // ë¶€ëª¨(.popup)ë¡œ ì´ë²¤íŠ¸ê°€ ì „ë‹¬ë˜ì§€ ì•Šë„ë¡ ë°©ì§€
      });
    });
    </script>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/ko.js"></script>
    <script>
      let calendar;
      let calendarEl;

      document.addEventListener('DOMContentLoaded', function() {
        calendarEl = document.getElementById('calendar');
        calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: 'dayGridWeek', // ì£¼ ë‹¨ìœ„ë¡œ í‘œì‹œ
          height: 'auto',
          headerToolbar: {
            left: 'prev',
            center: 'title',
            right: 'next'
          },
          views: {
            dayGridMonth: {
              titleFormat: { year: 'numeric', month: '2-digit' } // YYYY.MM í˜•ì‹
            },
            dayGridWeek: {
              titleFormat: { year: 'numeric', month: '2-digit'} // YYYY.MM.DD í˜•ì‹
            }
          },
          dayCellDidMount: function(info) {
            let cell = info.el;
            let existingDateEl = cell.querySelector('.fc-daygrid-day-number');

            if (existingDateEl) {
              existingDateEl.remove(); // ê¸°ì¡´ ë‚ ì§œ ì‚­ì œ
            }

            let dateEl = document.createElement('div');
            dateEl.classList.add('fc-daygrid-day-number');
            dateEl.innerText = info.date.getDate();

            dateEl.style.position = 'absolute';
            dateEl.style.top = '8px';
            dateEl.style.right = '8px';
            dateEl.style.fontSize = '14px';
            dateEl.style.fontWeight = 'bold';
            dateEl.style.zIndex = '10';

            // ìš”ì¼ì— ë”°ë¼ ìƒ‰ìƒ ë³€ê²½ (ì¼ìš”ì¼: ë¹¨ê°•, í† ìš”ì¼: íŒŒë‘)
            let dayOfWeek = info.date.getDay(); // 0: ì¼ìš”ì¼, 6: í† ìš”ì¼
            if (dayOfWeek === 0) {
              dateEl.style.color = 'red';
            } else if (dayOfWeek === 6) {
              dateEl.style.color = 'blue';
            } else {
              dateEl.style.color = 'black';
            }

            cell.appendChild(dateEl);
          },
          dayHeaderFormat: { weekday: 'short' }, // ìš”ì¼ë§Œ í‘œì‹œ
          datesSet: function(info) {
            // FullCalendarê°€ ê³„ì‚°í•œ íƒ€ì´í‹€ ë¬¸ìì—´
            const rawTitle = info.view.title; // ì˜ˆ: "2025/02"

            // ì—¬ê¸°ì„œ ì§ì ‘ split ì²˜ë¦¬
            const parts = rawTitle.split('/');
            let year = 'Unknown Year';
            let month = 'Unknown Month';

            if (parts.length === 2) {
              year = parts[1].trim();
              month = parts[0].trim();
            }

            // ê·¸ë‹¤ìŒ DOM ì¡°ì‘ (titleEl ì œê±°/ì¶”ê°€ ë“±)
            const titleEl = document.querySelector('.fc-toolbar-title');
            if (titleEl) {
                        titleEl.innerHTML = `
                            <div class="calendar-title">
                              <div class="calendar-year">${year}</div>
                              <div class="calendar-month">${month}</div>
                            </div>
                          `;
            }
            setTimeout(() => {
              document.querySelectorAll('.fc-daygrid-day').forEach(cell => {
                let existingDateEl = cell.querySelector('.fc-daygrid-day-number');

                // ê¸°ì¡´ ë‚ ì§œ ìš”ì†Œê°€ ìˆìœ¼ë©´ ì‚­ì œ
                if (existingDateEl) {
                  existingDateEl.remove();
                }

                // ìƒˆë¡œìš´ ë‚ ì§œ ìš”ì†Œ ìƒì„±
                let dateEl = document.createElement('div');
                dateEl.classList.add('fc-daygrid-day-number');

                // ë‚ ì§œ ê³„ì‚°
                let date = new Date(cell.getAttribute('data-date')).getDate();
                dateEl.innerText = date;

                // ë‚ ì§œ ìŠ¤íƒ€ì¼ ì ìš©
                dateEl.style.position = 'absolute';
                dateEl.style.top = '8px';
                dateEl.style.right = '8px';
                dateEl.style.fontSize = '14px';
                dateEl.style.color = 'black';
                dateEl.style.fontWeight = 'bold';
                dateEl.style.zIndex = '10';

                // ë‚ ì§œ ìš”ì†Œ ì¶”ê°€
                cell.appendChild(dateEl);
              });
            }, 50);
            setTimeout(adjustRowHeights, 50);
          },
          events: [],
          eventDidMount: function() {
            setTimeout(adjustRowHeights, 50);
          },
          eventContent: function(info) {
            let iconUrl = info.event.extendedProps.icon;
            return {
              html: `<div class="custom-event">
                        <div class="event-top">
                            <img src="${iconUrl}" alt="ìš´ë™ ì•„ì´ì½˜" class="event-icon">
                        </div>
                        <div class="event-text">${info.event.title}</div>
                     </div>`
            };
          }
        });

        // âœ… ğŸ“Œ ì„œë²„ì—ì„œ ìš´ë™ ê¸°ë¡ ê°€ì ¸ì™€ì„œ ìº˜ë¦°ë”ì— ì¶”ê°€
        fetch('/exercise/getExerciseEvents')
          .then(response => response.json())
          .then(exerciseList => {
            exerciseList.forEach(exercise => {
              calendar.addEvent({
                title: `ìš´ë™ ì¢…ëª©: ${exercise.exerciseName}<br>ìš´ë™ ì‹œê°„: ${exercise.hour}ì‹œê°„ ${exercise.minute}ë¶„<br>ì´ ì†Œëª¨ ì¹¼ë¡œë¦¬: <b class="highlight-kcal">742</b>kcal`,
                start: exercise.regDate,
                extendedProps: {
                  icon: '/images/ìš´ë™ì¼ëŸ¬.jpg',
                }
              });
            });
          })
          .catch(error => console.error("Error loading exercises:", error));

        function adjustRowHeights() {
          requestAnimationFrame(() => {
            document.querySelectorAll('.fc-daygrid-body tr').forEach(row => {
              let hasEvent = row.querySelector('.fc-daygrid-event'); // í•´ë‹¹ ì£¼ì— ì´ë²¤íŠ¸ê°€ ìˆëŠ”ì§€ í™•ì¸

              let targetHeight = hasEvent ? 230 : 150;
              let currentHeight = parseInt(window.getComputedStyle(row).height, 10);

              if (currentHeight !== targetHeight) {
                row.style.transition = 'height 0.3s ease-in-out';
                row.style.overflow = 'hidden';
                row.style.height = `${targetHeight}px`;
              }
            });
          });
        }

        calendar.render();
      });

      document.addEventListener("DOMContentLoaded", function () {
        const exercisePopup = document.querySelector(".exercise-type-popup");
        const exerciseTypeBtn = document.querySelector(".exercise-type-popup-btn");
        const exerciseTypeSaveBtn = document.querySelector(".exercise-type-save-btn");
        const exerciseTypeDisplay = document.querySelector("#selected-exercise");
        const exerciseTimeHour = document.querySelector("#hour");
        const exerciseTimeMinute = document.querySelector("#minute");
        const saveExerciseBtn = document.querySelector(".exercise-save");
        let selectedExercise = "";
        let selectedMet = 0; // MET ì €ì¥ ë³€ìˆ˜

        // ğŸ“Œ ìš´ë™ëª… ë¦¬ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸° (API í˜¸ì¶œ)
        fetch('/exercise/list')
                .then(response => response.json())
                .then(exerciseList => {
                  const exerciseContainer = document.querySelector(".exercise-type-popup__body");
                  exerciseContainer.innerHTML = "";

                  exerciseList.forEach(exercise => {
                    const exerciseDiv = document.createElement("div");
                    exerciseDiv.classList.add("exercise-item");
                    exerciseDiv.innerHTML =
                            `<div>${exercise.exerciseName}</div>
                    <input type="hidden" value="${exercise.metValue}">`;
                    // í´ë¦­ ì‹œ ì„ íƒëœ ìš´ë™ ì €ì¥
                    exerciseDiv.dataset.exerciseName = exercise.exerciseName;
                    exerciseDiv.dataset.metValue = exercise.metValue;
                    exerciseContainer.appendChild(exerciseDiv);
                  });
                })
                .catch(error => console.error("Error fetching exercises:", error));

        // ğŸ“Œ ìš´ë™ í´ë¦­ ì‹œ ì„ íƒ
        document.querySelector(".exercise-type-popup__body").addEventListener("click", function (event) {
          const selectedDiv = event.target.closest(".exercise-item");
          if (!selectedDiv) return;

          selectedExercise = selectedDiv.dataset.exerciseName; // ì„ íƒí•œ ìš´ë™ëª…
          selectedMet = selectedDiv.dataset.metValue; // ì„ íƒí•œ MET ê°’
          document.querySelectorAll(".exercise-item").forEach(div => div.classList.remove("selected"));
          selectedDiv.classList.add("selected");
        });

        // ğŸ“Œ ìš´ë™ ì„ íƒ í›„ ì €ì¥
        exerciseTypeSaveBtn.addEventListener("click", function () {
          if (!selectedExercise) {
            alert("ìš´ë™ì„ ì„ íƒí•´ì£¼ì„¸ìš”!");
            return;
          }

          exerciseTypeBtn.style.display = "none";
          exerciseTypeDisplay.style.display = "block";
          exerciseTypeDisplay.textContent = selectedExercise;

          // **ğŸš€ ì„ íƒí•œ ê°’ hidden inputìœ¼ë¡œ ì €ì¥ (ì„œë²„ ì „ì†¡ìš©)**
          document.querySelector("#selected-exercise-name").value = selectedExercise;
          document.querySelector("#selected-exercise-met").value = selectedMet;

          exercisePopup.style.display = "none";
        });

        // ğŸ“Œ ìš´ë™ ì €ì¥ ë²„íŠ¼ í´ë¦­ ì‹œ ë°ì´í„° ì „ì†¡
        saveExerciseBtn.addEventListener("click", function (event) {
          event.preventDefault();

          if (!selectedExercise) {
            alert("ìš´ë™ì„ ì„ íƒí•´ì£¼ì„¸ìš”!");
            return;
          }

          let hour = parseInt(exerciseTimeHour.value, 10);
          let minute = parseInt(exerciseTimeMinute.value, 10);
          let today = new Date().toLocaleDateString("ko-KR").replace(/. /g, "-").replace(".", "");

          let exerciseData = {
            exerciseName: selectedExercise,
            metValue: selectedMet,
            hour: hour,
            minute: minute,
            regDate: today
          };

          fetch('/exercise/saveExercise', {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(exerciseData)
          })
          .then(response => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.json();
          })
          .then(result => {
            alert(result.message); // âœ… ì˜¬ë°”ë¥¸ JSON ì‘ë‹µ ì²˜ë¦¬

            // âœ… ìƒˆë¡œìš´ ì´ë²¤íŠ¸ ê°ì²´ ìƒì„±
            let newEvent = {
              title: `ìš´ë™ ì¢…ëª©: ${selectedExercise}<br>ìš´ë™ ì‹œê°„: ${hour}ì‹œê°„ ${minute}ë¶„<br>ì´ ì†Œëª¨ ì¹¼ë¡œë¦¬: <b class="highlight-kcal">742</b>kcal`,
              start: today,
              extendedProps: {
                icon: '/images/ìš´ë™ì¼ëŸ¬.jpg',
              }
            };
            // âœ… ê¸°ì¡´ ì´ë²¤íŠ¸ ëª¨ë‘ ì‚­ì œ (ê°•ì œ ë¦¬í”„ë ˆì‹œ)
            calendar.removeAllEvents();

            // âœ… ìƒˆë¡œìš´ ì´ë²¤íŠ¸ ì¶”ê°€
            calendar.addEvent(newEvent);

            // âœ… ğŸ“Œ ì„œë²„ì—ì„œ ìš´ë™ ê¸°ë¡ ê°€ì ¸ì™€ì„œ ìº˜ë¦°ë”ì— ì¶”ê°€
            fetch('/exercise/getExerciseEvents')
                    .then(response => response.json())
                    .then(exerciseList => {
                      exerciseList.forEach(exercise => {
                        calendar.addEvent({
                          title: `ìš´ë™ ì¢…ëª©: ${exercise.exerciseName}<br>ìš´ë™ ì‹œê°„: ${exercise.hour}ì‹œê°„ ${exercise.minute}ë¶„<br>ì´ ì†Œëª¨ ì¹¼ë¡œë¦¬: <b class="highlight-kcal">742</b>kcal`,
                          start: exercise.regDate,
                          extendedProps: {
                            icon: '/images/ìš´ë™ì¼ëŸ¬.jpg',
                          }
                        });
                      });
                    })
                    .catch(error => console.error("Error loading exercises:", error));

            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            exerciseTypeDisplay.textContent = "";
            exerciseTypeDisplay.style.display = "none";
            exerciseTypeBtn.style.display = "inline-block";
            exerciseTimeHour.value = "00";
            exerciseTimeMinute.value = "00";

          })
          .catch(error => console.error("Error saving exercise:", error));

          // ìº˜ë¦°ë”ë¡œ í¬ì»¤ìŠ¤
          setTimeout(() => {
            var calendarEl = document.getElementById('calendar'); // ìº˜ë¦°ë”ì˜ DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
            if (calendarEl) {
              calendarEl.scrollIntoView({ behavior: 'smooth', block: 'center' }); // ìŠ¤í¬ë¡¤ ì´ë™
              calendarEl.focus(); // í¬ì»¤ìŠ¤ ì„¤ì • (ì„ íƒì‚¬í•­)
            }
          }, 300);

          calendar.render();
        });
      });
    </script>
    <script>
      function graphSaveCheck() {
        // ì…ë ¥ í•„ë“œ ê°€ì ¸ì˜¤ê¸°
        const bloodSugarInput = document.getElementById("blood_sugar");
        const bloodPressInput = document.getElementById("blood_press");
        const weightInput = document.getElementById("weight");

        // ì…ë ¥ ê°’ ê°€ì ¸ì˜¤ê¸°
        const bloodSugar = bloodSugarInput.value.trim();
        const bloodPress = bloodPressInput.value.trim();
        const weight = weightInput.value.trim();

        // ìµœì†Œ í•˜ë‚˜ ì´ìƒì˜ ì…ë ¥ê°’ì´ í•„ìš”í•¨
        if (!bloodSugar && !bloodPress && !weight) {
          alert("ìˆ˜ì¹˜ë¥¼ í•œ ê°œ ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.");

          // ë¹„ì–´ ìˆëŠ” ì²« ë²ˆì§¸ ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤ ë§ì¶”ê¸°
          if (!bloodSugar) {
            bloodSugarInput.focus();
          }

          return; // ì„œë²„ë¡œ ìš”ì²­ ë³´ë‚´ì§€ ì•ŠìŒ
        }

        // ë°ì´í„° ê°ì²´ ìƒì„±
        const data = {
          bloodSugar: bloodSugar || null, // ê°’ì´ ë¹„ì–´ìˆìœ¼ë©´ nullë¡œ ì „ë‹¬
          bloodPress: bloodPress || null,
          weight: weight || null
        };

        // ì„œë²„ë¡œ ë°ì´í„° ì „ì†¡
        fetch('/exercise/saveGraph', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        })
        .then(response => response.text())
        .then(result => {
          alert(result); // ì €ì¥ ì„±ê³µ ë©”ì‹œì§€

          // âœ… ì…ë ¥ í•„ë“œ ì´ˆê¸°í™” (ê°’ì„ ë¹„ì›€)
          bloodSugarInput.value = "";
          bloodPressInput.value = "";
          weightInput.value = "";

          // âœ… ì²« ë²ˆì§¸ ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤ ë§ì¶”ê¸°
          bloodSugarInput.focus();
        })
        .catch(error => console.error('Error:', error));
      }

      function targetSaveCheck(event) {
        event.preventDefault(); // ê¸°ë³¸ ì œì¶œ ë°©ì§€

        // ì…ë ¥ í•„ë“œ ê°€ì ¸ì˜¤ê¸°
        const exerciseTargetInput = document.querySelector("[name='exercise_target']");
        const valueTargetInput = document.querySelector("[name='value_target']");
        const kcalTargetInput = document.querySelector("[name='kcal_target']");

        // ì…ë ¥ ê°’ ê°€ì ¸ì˜¤ê¸°
        const exerciseTarget = exerciseTargetInput.value.trim();
        const valueTarget = valueTargetInput.value.trim();
        const kcalTarget = kcalTargetInput.value.trim();

        // ìµœì†Œ í•˜ë‚˜ ì´ìƒì˜ ì…ë ¥ê°’ì´ í•„ìš”í•¨
        if (!exerciseTarget && !valueTarget && !kcalTarget) {
          alert("ëª©í‘œë¥¼ í•œ ê°œ ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.");

          // ë¹„ì–´ ìˆëŠ” ì²« ë²ˆì§¸ ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤ ë§ì¶”ê¸°
          if (!exerciseTarget) {
            exerciseTargetInput.focus();
          } else if (!valueTarget) {
            valueTargetInput.focus();
          } else {
            kcalTargetInput.focus();
          }

          return; // ì„œë²„ë¡œ ìš”ì²­ ë³´ë‚´ì§€ ì•ŠìŒ
        }

        // ë°ì´í„° ê°ì²´ ìƒì„±
        const data = {
          exerciseTarget: exerciseTarget || null, // ê°’ì´ ë¹„ì–´ìˆìœ¼ë©´ nullë¡œ ì „ë‹¬
          valueTarget: valueTarget || null,
          kcalTarget: kcalTarget || null
        };

        // ì„œë²„ë¡œ ë°ì´í„° ì „ì†¡
        fetch('/exercise/saveTarget', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        })
        .then(response => response.json()) // ì„œë²„ ì‘ë‹µì„ JSONìœ¼ë¡œ ë°›ìŒ
        .then(result => {
          alert(result.message); // ì €ì¥ ì„±ê³µ ë©”ì‹œì§€

          // âœ… ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
          exerciseTargetInput.value = "";
          valueTargetInput.value = "";
          kcalTargetInput.value = "";

          // âœ… ì²« ë²ˆì§¸ ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤ ë§ì¶”ê¸°
          $('.target-popup').css('display', 'none');
        })
        .catch(error => console.error('Error:', error));
      }

      document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("target-form").addEventListener("submit", targetSaveCheck);
        const userPk = 2; // í˜„ì¬ ì‚¬ìš©ì ID (ì‹¤ì œ êµ¬í˜„ ì‹œ ì„¸ì…˜ì—ì„œ ê°€ì ¸ì˜¤ê¸°)
        fetch(`/exercise/current-week?userPk=${userPk}`)
                .then(response => {
                  if (!response.ok) throw new Error("No target data available");
                  return response.json();
                })
                .then(data => {
                  if (!data) return;

                  // âœ… ìš´ë™ íšŸìˆ˜ ë°˜ì˜
                  document.querySelector(".target-1 .current").textContent = `${data.exerciseCount}íšŒ`;
                  document.querySelector(".target-1 .goal").textContent = `${data.exerciseTarget}íšŒ`;

                  // âœ… ìˆ˜ì¹˜ ê¸°ë¡ íšŸìˆ˜ ë°˜ì˜
                  document.querySelector(".target-2 .current").textContent = `${data.valueCount}íšŒ`;
                  document.querySelector(".target-2 .goal").textContent = `${data.valueTarget}íšŒ`;

                  // âœ… ì¹¼ë¡œë¦¬ ì†Œëª¨ëŸ‰ ë°˜ì˜
                  document.querySelector(".target-3 .current").textContent = `${data.kcalSum}kcal`;
                  document.querySelector(".target-3 .goal").textContent = `${data.kcalTarget}kcal`;

                  // âœ… ì§„í–‰ ë°” ì—…ë°ì´íŠ¸
                  updateProgress(".target-1 .target-progress", data.exerciseCount, data.exerciseTarget);
                  updateProgress(".target-2 .target-progress", data.valueCount, data.valueTarget);
                  updateProgress(".target-3 .target-progress", data.kcalSum, data.kcalTarget);
                })
                .catch(error => console.error("Error loading target data:", error));
      });

      // âœ… ëª©í‘œ ì§„í–‰ ë°” ì—…ë°ì´íŠ¸ í•¨ìˆ˜
      function updateProgress(selector, current, goal) {
        const progressBar = document.querySelector(selector);
        if (!progressBar) return;

        const percentage = goal === 0 ? 0 : (current / goal) * 100;
        progressBar.style.width = `${percentage}%`;
      }
    </script>
</head>
<body>

<!--header-->
<div th:insert="~{/common/header.html}"></div>

<div class="target-popup">
  <div class="target-popup-content">
    <div class="target-popup__head">
      <div>ì£¼ê°„ ëª©í‘œ ì„¤ì •í•˜ê¸° <i class="fa-solid fa-trophy"></i></div>
      <button class="target-popup-close-btn">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
    <div class="target-popup__body">
      <form id="target-form">
        <ul>
          <li>
            ì´ë²ˆ ì£¼ ìš´ë™ íšŸìˆ˜ ëª©í‘œ :
            <input type="number" name="exercise_target" min="0" step="1"> íšŒ
          </li>
          <li>
            ì´ë²ˆ ì£¼ ìˆ˜ì¹˜ ê¸°ë¡ íšŸìˆ˜ ëª©í‘œ :
            <input type="number" name="value_target" min="0" step="1"> íšŒ
          </li>
          <li>
            ì´ë²ˆ ì£¼ ì†Œëª¨ ì¹¼ë¡œë¦¬ ëª©í‘œ : <input type="number" name="kcal_target" min="0" step="1"> kcal
          </li>
        </ul>
        <button type="submit" class="target-save-btn" onclick="targetSaveCheck()">ì € ì¥</button>
      </form>
    </div>
  </div>
</div>

<div class="exercise-type-popup">
  <div class="exercise-type-popup-content">
    <div class="exercise-type-popup__head">
      <div>
        <input id="exercise-search" type="text" placeholder="ì¢…ëª© ì´ë¦„ì„ ê²€ìƒ‰í•˜ì„¸ìš”">
        <button class="search-btn"><i class="fa-solid fa-magnifying-glass"></i></button>
      </div>
      <button class="exercise-type-popup-close-btn">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
    <div class="exercise-type-popup__body"></div>
    <div class="exercise-type-popup__foot">
      <button type="button" class="exercise-type-save-btn">ì € ì¥</button>
    </div>
  </div>
</div>

<section class="main">

  <div class="top-service">
    <div class="left-service">
      <h2>ì£¼ê°„ ëª©í‘œ <i class="fa-solid fa-trophy"></i></h2>
      <div class="target-box">
        <div class="target-1">
          <div><span>ì´ë²ˆ ì£¼ ìš´ë™ íšŸìˆ˜</span></div>
          <div>
            <div class="target-values">
              <span class="current">1íšŒ</span>
              <span class="goal">3íšŒ</span>
            </div>
            <div class="target-bar">
              <div class="target-progress"></div>
            </div>
          </div>
        </div>
        <div class="target-2">
          <div><span>ì´ë²ˆ ì£¼ ìˆ˜ì¹˜ ê¸°ë¡ íšŸìˆ˜</span></div>
          <div>
            <div class="target-values">
              <span class="current">1íšŒ</span>
              <span class="goal">3íšŒ</span>
            </div>
            <div class="target-bar">
              <div class="target-progress"></div>
            </div>
          </div>
        </div>
        <div class="target-3">
          <div><span>ì´ë²ˆ ì£¼ ì¹¼ë¡œë¦¬ ì†Œëª¨ëŸ‰</span></div>
          <div>
            <div class="target-values">
              <span class="current">742kcal</span>
              <span class="goal">2,000kcal</span>
            </div>
            <div class="target-bar">
              <div class="target-progress"></div>
            </div>
          </div>
        </div>
        <button type="button" class="target-write-btn">ëª©í‘œ ì‘ì„±</button>
      </div>
    </div>
    <div class="right-service">
      <h2>ì˜¤ëŠ˜ì˜ ìˆ˜ì¹˜ ê¸°ë¡í•˜ê¸° <i class="fa-solid fa-pencil"></i></h2>
      <div class="graph">
        <form name="graph-frm">
          <ul>
            <li>í˜ˆë‹¹ <input type="text" id="blood_sugar" name="blood_sugar" required> mg/dL</li>
            <li>í˜ˆì•• <input type="text" id="blood_press" name="blood_press" required> mmHg</li>
            <li>ëª¸ë¬´ê²Œ <input type="text" id="weight" name="weight" class="weight" required> kg</li>
          </ul>
          <button type="button" class="save-button" onclick="graphSaveCheck()">ì € ì¥</button>
        </form>
      </div>
      <div class="cumulative-count">
        <div class="cumulative-title">
          <span>ë‚´ê°€ ë‹¬ì„±í•œ ì£¼ê°„ ëª©í‘œ ìˆ˜ <i class="fa-solid fa-medal"></i> </span>
          <span>ë‚´ê°€ ìš´ë™ ê¸°ë¡í•œ íšŸìˆ˜ <i class="fa-solid fa-medal"></i> </span>
        </div>
        <div class="cumulative-total">
          <span>32íšŒ</span>
          <span>151íšŒ</span>
        </div>
      </div>
    </div>
  </div>

  <div class="exercise-entry">
    <form>
      <div class="exercise-type">
        ìš´ë™ ì¢…ë¥˜ :
        <span id="selected-exercise"></span>
        <i class="exercise-type-popup-btn fa-solid fa-plus"></i>
      </div>
      <input type="hidden" id="selected-exercise-name" name="exerciseName">
      <input type="hidden" id="selected-exercise-met" name="met">

      <div class="exercise-time">
        <input type="hidden" id="selected-date" name="selectdate">
        ìš´ë™ ì‹œê°„ :
        <select id="hour" name="hour">
          <option value="00" selected>0ì‹œê°„</option>
          <option value="01">1ì‹œê°„</option>
          <option value="02">2ì‹œê°„</option>
          <option value="03">3ì‹œê°„</option>
          <option value="04">4ì‹œê°„</option>
          <option value="05">5ì‹œê°„</option>
        </select> :
        <select id="minute" name="minute">
          <option value="00" selected>0ë¶„</option>
          <option value="15">15ë¶„</option>
          <option value="30">30ë¶„</option>
          <option value="45">45ë¶„</option>
        </select>
      </div>
      <button type="submit" class="exercise-save">ì € ì¥</button>
    </form>
  </div>

  <div class="calendar" id="calendar"></div>

</section>

<!--footer-->
<div th:insert="~{/common/footer.html}"></div>

</body>
</html>